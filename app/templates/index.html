<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Compara precios en tiempo real de Amazon, BestBuy y más. Análisis inteligente con IA para encontrar las mejores ofertas.">
    <title>PriceFinder IA - Comparador Inteligente de Precios en Tiempo Real</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- CSS personalizado -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4f46e5',
                        secondary: '#06b6d4',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 min-h-screen">
    
    <!-- Header Profesional -->
    <header class="bg-white shadow-lg sticky top-0 z-50 border-b-2 border-indigo-100">
        <div class="container mx-auto px-4 lg:px-8 py-4">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="flex items-center space-x-3">
                    <div class="bg-gradient-to-br from-indigo-600 to-purple-600 p-3 rounded-xl shadow-lg">
                        <i class="fas fa-shopping-cart text-3xl text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                            PriceFinder IA
                        </h1>
                        <p class="text-xs sm:text-sm text-gray-600">
                            Comparación en Tiempo Real con IA
                            <span class="hidden sm:inline text-gray-400 mx-2">•</span>
                            <span class="hidden sm:inline text-gray-500">by Raul Pivet Alvarez</span>
                        </p>
                    </div>
                </div>
                <div class="flex items-center gap-2 sm:gap-4">
                    <!-- Botón Test API - MÁS VISIBLE -->
                    <a href="/test" target="_blank"
                       class="flex items-center gap-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-4 sm:px-5 py-2.5 rounded-xl font-bold text-xs sm:text-sm transition-all shadow-lg hover:shadow-xl">
                        <i class="fas fa-vial"></i>
                        <span>Test Tiendas</span>
                    </a>
                    <!-- Trust Badges -->
                    <div class="hidden md:flex items-center space-x-2 bg-green-50 px-4 py-2 rounded-lg border border-green-200">
                        <i class="fas fa-shield-alt text-green-600"></i>
                        <span class="text-sm font-semibold text-green-700">100% Seguro</span>
                    </div>
                    <div class="hidden lg:flex items-center space-x-2 bg-blue-50 px-4 py-2 rounded-lg border border-blue-200">
                        <i class="fas fa-clock text-blue-600"></i>
                        <span class="text-sm font-semibold text-blue-700">Datos en Vivo</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section con Value Proposition -->
    <section class="container mx-auto px-4 lg:px-8 py-8">
        <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 rounded-3xl shadow-2xl p-8 lg:p-12 text-white mb-8">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4">
                    🎯 Encuentra el Mejor Precio en Segundos
                </h2>
                <p class="text-lg sm:text-xl mb-6 text-indigo-100">
                    Comparamos precios reales en <strong>Amazon, BestBuy y más</strong> usando Inteligencia Artificial
                </p>
                <div class="grid grid-cols-1 sm:grid-cols-4 gap-4 mt-8">
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20">
                        <div class="text-3xl font-bold">✅</div>
                        <div class="text-sm mt-2 font-semibold">Amazon + eBay</div>
                        <div class="text-xs opacity-75">100% Gratis</div>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20">
                        <div class="text-3xl font-bold">🤖</div>
                        <div class="text-sm mt-2">Análisis con IA</div>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20">
                        <div class="text-3xl font-bold">💰</div>
                        <div class="text-sm mt-2">Ahorra hasta 40%</div>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-purple-300">
                        <div class="text-3xl font-bold">💎</div>
                        <div class="text-sm mt-2 font-semibold">Walmart + BestBuy</div>
                        <div class="text-xs opacity-75">Con API Premium</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <main class="container mx-auto px-4 lg:px-8 pb-12">
        
        <!-- Search Section Mejorada -->
        <div class="bg-white rounded-3xl shadow-2xl p-6 sm:p-8 lg:p-10 mb-8 border border-gray-100">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl lg:text-3xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-search mr-3 text-indigo-600"></i>
                    <span>Comenzar Comparación</span>
                </h2>
                <div class="text-xs text-gray-500 hidden sm:block">
                    <i class="fas fa-users text-indigo-600"></i> <span id="liveUsers" class="font-semibold">127</span> usuarios ahora
                </div>
            </div>
            
            <form id="searchForm" class="space-y-6">
                <!-- API Keys en Grid Responsivo -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6">
                    <!-- Gemini API Key -->
                    <div class="relative">
                        <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                            <i class="fas fa-robot text-purple-500 mr-2"></i>
                            Gemini API Key
                            <a href="https://aistudio.google.com/app/apikey" target="_blank" 
                               class="ml-2 text-xs text-blue-600 hover:text-blue-800 underline">
                                (Obtener gratis)
                            </a>
                        </label>
                        <input 
                            type="password" 
                            id="geminiKey"
                            placeholder="AIza..." 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition text-sm sm:text-base"
                            required
                        >
                        <button type="button" onclick="togglePassword('geminiKey')" 
                                class="absolute right-3 top-11 text-gray-500 hover:text-gray-700">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    
                    <!-- Scraper API Key -->
                    <div class="relative">
                        <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                            <i class="fas fa-globe text-cyan-500 mr-2"></i>
                            Scraper API Key
                            <a href="https://www.scraperapi.com/signup" target="_blank" 
                               class="ml-2 text-xs text-blue-600 hover:text-blue-800 underline">
                                (5,000 gratis/mes)
                            </a>
                        </label>
                        <input 
                            type="password" 
                            id="scraperKey"
                            placeholder="Tu Scraper API Key" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition text-sm sm:text-base"
                            required
                        >
                        <button type="button" onclick="togglePassword('scraperKey')" 
                                class="absolute right-3 top-11 text-gray-500 hover:text-gray-700">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <!-- Product Search con Sugerencias -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                        <i class="fas fa-box-open text-orange-500 mr-2"></i>
                        ¿Qué producto quieres buscar?
                    </label>
                    <div class="relative">
                        <input 
                            type="text" 
                            id="productName"
                            placeholder='Ej: "iPhone 15 Pro", "Sony WH-1000XM5", "iPad Air"' 
                            class="w-full px-4 py-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition text-base"
                            required
                        >
                        <div class="absolute right-3 top-4 text-gray-400">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    <!-- Productos Populares -->
                    <div class="flex flex-wrap gap-2 mt-3">
                        <span class="text-xs text-gray-600">Popular:</span>
                        <button type="button" onclick="setProduct('iPhone 15')" 
                                class="text-xs bg-gray-100 hover:bg-indigo-100 px-3 py-1 rounded-full text-gray-700 transition">
                            iPhone 15
                        </button>
                        <button type="button" onclick="setProduct('MacBook Air M2')" 
                                class="text-xs bg-gray-100 hover:bg-indigo-100 px-3 py-1 rounded-full text-gray-700 transition">
                            MacBook Air M2
                        </button>
                        <button type="button" onclick="setProduct('AirPods Pro')" 
                                class="text-xs bg-gray-100 hover:bg-indigo-100 px-3 py-1 rounded-full text-gray-700 transition">
                            AirPods Pro
                        </button>
                    </div>
                </div>
                
                <!-- CTA Button Mejorado -->
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button 
                        type="submit" 
                        id="searchBtn"
                        class="w-full sm:w-auto bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 px-12 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:scale-105 flex items-center justify-center space-x-3"
                    >
                        <i class="fas fa-search-dollar text-xl"></i>
                        <span class="text-lg">Comparar Precios Ahora</span>
                    </button>
                </div>

                <!-- Info de Tiendas con Badge Free/Premium -->
                <div class="bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl p-4 border border-gray-200">
                    <div class="flex items-center justify-center flex-wrap gap-3 sm:gap-4 text-xs text-gray-700">
                        <span class="font-bold text-gray-800">Comparamos en tiempo real:</span>
                        <div class="flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg shadow-sm border-2 border-green-300">
                            <i class="fab fa-amazon text-orange-500 text-lg"></i>
                            <span class="font-semibold">Amazon</span>
                            <span class="text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-bold">FREE</span>
                        </div>
                        <div class="flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg shadow-sm border-2 border-green-300">
                            <i class="fab fa-ebay text-red-500 text-lg"></i>
                            <span class="font-semibold">eBay</span>
                            <span class="text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-bold">FREE</span>
                        </div>
                        <div class="flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg shadow-sm border border-gray-300 opacity-75">
                            <i class="fas fa-store text-blue-500 text-lg"></i>
                            <span class="font-semibold">Walmart</span>
                            <span class="text-[10px] bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full font-bold">PRO</span>
                        </div>
                        <div class="flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg shadow-sm border border-gray-300 opacity-75">
                            <i class="fas fa-shopping-bag text-blue-600 text-lg"></i>
                            <span class="font-semibold">Best Buy</span>
                            <span class="text-[10px] bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full font-bold">PRO</span>
                        </div>
                    </div>
                    <p class="text-center text-xs text-gray-600 mt-3">
                        <i class="fas fa-info-circle text-blue-500"></i>
                        <span class="font-semibold">Walmart y Best Buy</span> requieren ScraperAPI plan pago para funcionar
                    </p>
                </div>
            </form>
        </div>
        
        <!-- Loading Spinner Mejorado -->
        <div id="loadingSpinner" class="hidden">
            <div class="bg-white rounded-3xl shadow-2xl p-8 sm:p-12 mb-8 border border-gray-100">
                <div class="flex flex-col items-center space-y-6">
                    <div class="relative">
                        <div class="animate-spin rounded-full h-20 w-20 border-b-4 border-indigo-600"></div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <i class="fas fa-shopping-cart text-indigo-600 text-2xl"></i>
                        </div>
                    </div>
                    <div class="text-center">
                        <p class="text-2xl font-bold text-gray-800 mb-2">Analizando Precios...</p>
                        <p class="text-sm text-gray-600" id="loadingStatus">Conectando con tiendas en línea</p>
                    </div>
                    <div class="w-full max-w-md bg-gray-200 rounded-full h-2 overflow-hidden">
                        <div id="progressBar" class="bg-gradient-to-r from-indigo-600 to-purple-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Error Message Mejorado -->
        <div id="errorMessage" class="hidden bg-red-50 border-l-4 border-red-500 rounded-xl p-6 mb-8 shadow-lg">
            <div class="flex items-start">
                <i class="fas fa-exclamation-triangle text-red-500 text-3xl mr-4 mt-1"></i>
                <div class="flex-1">
                    <h3 class="text-lg font-bold text-red-800 mb-2">Error en la búsqueda</h3>
                    <p id="errorText" class="text-red-700 mb-3"></p>
                    <button onclick="hideError()" class="text-sm bg-red-100 hover:bg-red-200 text-red-800 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-times mr-2"></i>Cerrar
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Results Section -->
        <div id="resultsSection" class="hidden space-y-8">
            
            <!-- AI Summary Card Mejorada -->
            <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 rounded-3xl shadow-2xl p-6 sm:p-10 text-white">
                <div class="flex flex-col sm:flex-row items-start justify-between mb-6">
                    <h2 class="text-2xl sm:text-3xl font-bold flex items-center mb-4 sm:mb-0">
                        <i class="fas fa-robot mr-3"></i>
                        Análisis Inteligente
                    </h2>
                    <div class="bg-white/20 backdrop-blur-sm px-4 py-2 rounded-xl border border-white/30">
                        <i class="fas fa-sparkles mr-2"></i>
                        <span class="font-semibold">Powered by Gemini</span>
                    </div>
                </div>
                <p id="aiSummary" class="text-lg sm:text-xl leading-relaxed"></p>
            </div>
            
            <!-- AI Insights Section -->
            <div id="aiInsights" class="hidden bg-white rounded-3xl shadow-2xl p-6 sm:p-8 border border-gray-100">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-lightbulb mr-3 text-yellow-500"></i>
                    Insights Inteligentes
                </h2>
                <div id="insightsList" class="space-y-4">
                    <!-- Insights will be inserted here -->
                </div>
            </div>
            
            <!-- Statistics Cards Responsivas -->
            <div id="statisticsCards" class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
                <!-- Cards will be inserted here -->
            </div>
            
            <!-- Price Chart Responsivo -->
            <div class="bg-white rounded-3xl shadow-2xl p-6 sm:p-8 border border-gray-100">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-chart-bar mr-3 text-indigo-600"></i>
                    Comparación Visual de Precios
                </h2>
                <div class="relative" style="height: 300px;">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>
            
            <!-- Products Cards/Table Responsivo -->
            <div class="bg-white rounded-3xl shadow-2xl p-6 sm:p-8 border border-gray-100">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-list mr-3 text-indigo-600"></i>
                    Resultados Detallados
                </h2>
                
                <!-- Vista de Cards para Móvil -->
                <div id="productCards" class="block lg:hidden space-y-4">
                    <!-- Cards will be inserted here by JavaScript -->
                </div>
                
                <!-- Vista de Tabla para Desktop -->
                <div class="hidden lg:block overflow-x-auto">
                    <table class="w-full" id="productsTable">
                        <thead>
                            <tr class="bg-gradient-to-r from-indigo-50 to-purple-50 border-b-2 border-indigo-200">
                                <th class="px-6 py-4 text-left text-sm font-bold text-gray-700">Tienda</th>
                                <th class="px-6 py-4 text-left text-sm font-bold text-gray-700">Producto</th>
                                <th class="px-6 py-4 text-center text-sm font-bold text-gray-700">Condición</th>
                                <th class="px-6 py-4 text-center text-sm font-bold text-gray-700">Precio</th>
                                <th class="px-6 py-4 text-center text-sm font-bold text-gray-700">vs Promedio</th>
                                <th class="px-6 py-4 text-center text-sm font-bold text-gray-700">Valor</th>
                                <th class="px-6 py-4 text-center text-sm font-bold text-gray-700">Recomendación</th>
                                <th class="px-6 py-4 text-center text-sm font-bold text-gray-700">Acción</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- CTA Final -->
            <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-3xl shadow-2xl p-6 sm:p-10 text-white text-center">
                <h3 class="text-2xl sm:text-3xl font-bold mb-4">¿Te Ahorramos Dinero? 🎉</h3>
                <p class="text-lg mb-6">Comparte PriceFinder IA con tus amigos y ayúdalos a ahorrar también</p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button onclick="shareOnTwitter()" class="bg-white/20 hover:bg-white/30 backdrop-blur-sm px-6 py-3 rounded-xl transition border border-white/30">
                        <i class="fab fa-twitter mr-2"></i>Compartir en Twitter
                    </button>
                    <button onclick="copyLink()" class="bg-white/20 hover:bg-white/30 backdrop-blur-sm px-6 py-3 rounded-xl transition border border-white/30">
                        <i class="fas fa-link mr-2"></i>Copiar Enlace
                    </button>
                </div>
            </div>
        </div>
        
    </main>

    <!-- Footer Profesional -->
    <footer class="bg-white mt-12 py-8 shadow-inner border-t border-gray-200">
        <div class="container mx-auto px-4 lg:px-8">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 mb-8">
                <div>
                    <h4 class="font-bold text-gray-800 mb-4">PriceFinder IA</h4>
                    <p class="text-sm text-gray-600">Comparador inteligente de precios en tiempo real.</p>
                </div>
                <div>
                    <h4 class="font-bold text-gray-800 mb-4">Tiendas</h4>
                    <ul class="text-sm text-gray-600 space-y-2">
                        <li><i class="fab fa-amazon text-orange-500"></i> Amazon</li>
                        <li><i class="fas fa-store text-blue-500"></i> Walmart</li>
                        <li><i class="fab fa-ebay text-red-500"></i> eBay</li>
                        <li><i class="fas fa-shopping-bag text-blue-600"></i> Best Buy</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-gray-800 mb-4">Tecnología</h4>
                    <ul class="text-sm text-gray-600 space-y-2">
                        <li><i class="fas fa-robot"></i> Google Gemini IA</li>
                        <li><i class="fas fa-globe"></i> Scraper API</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-gray-800 mb-4">Seguridad</h4>
                    <div class="flex items-center space-x-2 text-sm text-gray-600">
                        <i class="fas fa-shield-alt text-green-600"></i>
                        <span>100% Seguro</span>
                    </div>
                    <div class="flex items-center space-x-2 text-sm text-gray-600 mt-2">
                        <i class="fas fa-lock text-blue-600"></i>
                        <span>Datos Encriptados</span>
                    </div>
                </div>
            </div>
            <div class="text-center text-sm text-gray-600 border-t border-gray-200 pt-6">
                <p class="mb-2">
                    <i class="fas fa-code text-indigo-600"></i>
                    Desarrollado con 
                    <i class="fas fa-heart text-red-500"></i> 
                    por <span class="font-bold text-indigo-600">Raul Pivet Alvarez</span>
                </p>
                <p class="text-xs text-gray-500 mb-1">
                    Powered by Flask, Google Gemini IA & ScraperAPI
                </p>
                <p class="text-xs text-gray-500">
                    Los precios son reales y actualizados en tiempo real. No guardamos tus API keys.
                </p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // Funciones auxiliares inline
        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            field.type = field.type === 'password' ? 'text' : 'password';
        }

        function setProduct(productName) {
            document.getElementById('productName').value = productName;
        }

        function shareOnTwitter() {
            const text = encodeURIComponent('¡Acabo de encontrar el mejor precio usando PriceFinder IA! 🎯💰');
            const url = encodeURIComponent(window.location.href);
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href);
            alert('¡Enlace copiado al portapapeles!');
        }

        // Simular usuarios en línea (número aleatorio realista)
        function updateLiveUsers() {
            const users = Math.floor(Math.random() * 50) + 100;
            const element = document.getElementById('liveUsers');
            if (element) element.textContent = users;
        }
        updateLiveUsers();
        setInterval(updateLiveUsers, 30000); // Actualizar cada 30 segundos
    </script>
</body>
</html>
